### Chapter 1

#### 约束

对于状态和控制输入的约束，可以表示为：
$$
Eu(k)\leq e\ \ \ \ E=\begin{bmatrix} 
I \\
-I
\end{bmatrix}\ \ \ \ e=\begin{bmatrix} 
\overline{u} \\
-\underline{u}\ 
\end{bmatrix}\\
Fu(k)\leq f\ \ \ \ F=\begin{bmatrix} 
I \\
-I
\end{bmatrix}\ \ \ \ f=\begin{bmatrix} 
\overline{x} \\
-\underline{x}\ 
\end{bmatrix}
$$
对于控制输入变化率约束的表达，可以增广状态：

![01](.\image\01.png)

![01](.\image\02.png)

对于状态的变化率约束，可以通过状态空间直接得到：
$$
\Delta x(k+1)=A\Delta x(k)+B\Delta u(k)
$$


#### 软约束

在优化问题中，对于控制输入的约束通常代表着真实的物理限制，必须要遵守；而对状态或测量输出的约束通常代表着对系统的“要求”。这些要求可能无法达到，MPC 的控制器需要实时决策这些约束是否不可行，如果不可行就需要放松这些约束（具体怎么做在第二章）。所以对于控制输入就使用硬约束，对于状态和输出就使用软约束。

给系统加入软约束，由于软约束是需要通过反馈来决定其大小的，所以可以增广至控制输入中：

![03](.\image\03.png)

#### 优化多级函数

对于线性时不变系统：

![04](.\image\04.png)

MPC 调节器的目标函数：

![05](.\image\05.png)

这是一个多级函数，$x(k+1)$ 由 $x(k)$ 和 $u(k)$ 决定，依次递推，写成简单的形式：

![06](.\image\06.png)

这里的 $w$ 类似 $u_0$ ，那么可以从后向前优化(动态规划)：

![07](.\image\07.png)

书里还写了前向DP（用于状态估计），与动态规划类似，只是方向不同。

#### 动态规划求解

![05](.\image\05.png)

改写为以下形式：

![08](.\image\08.png)

使用动态规划，将$x(N)$ 用 $x(N-1)$ 和 $u(N-1)$表示：

![09](.\image\10.png)

对 $u(N-1)$ 求导，使导数等于 0 可得到最优解。

![09](.\image\09.png)

由此依次向前求解直到 $x(0)$ 即可得到最优解序列。

#### 跟踪问题

![11](.\image\11.png)

如果要让 1.40 对每个指定的输出值都有解，那么要求其像空间的维数等于矩阵的行数（$(n+p)\times n(+m)$），即至少需要 $p\leq m$ 。p 代表输出的维数，m 代表控制输入的维数。这就要求需要的输入至少与输出一样多，如果无法满足这个要求，就要减少目标输出的维数：$r = Hy$ 。

![12](.\image\12.png)

通过求解这个优化问题，可以得到最优稳态解（加权最小二乘），接下来对稳态跟踪系统求解最优控制率即可：

![16](.\image\16.png)

#### 干扰和无偏跟踪

应用中的另一个常见目标是使用反馈控制器来补偿输入对系统未测量的干扰，从而减轻干扰对受控变量的影响。此问题称为干扰抑制。我们可能希望设计一个反馈控制器来补偿非零干扰，使选定的受控变量渐近接近其设定值而不会发生偏移。此属性称为无偏跟踪。在本节中，我们将介绍一种构建 MPC 控制器以实现零偏移的简单方法。

补偿未测量干扰的一种简单方法是

1. 对扰动进行建模，
2. 使用测量和模型来估计扰动，
3. 将扰动对受控变量的影响降至最低的输入。

积分形式的扰动建模：$d^{+}=d+w_d$

![13](.\image\13.png)



$B_d$ 和 $C_d$ 的选择可以自主决定，但是要保证增广后的系统可检测：

![14](.\image\14.png)

可检测性（detectability）是比客观性更弱的性质。如果系统存在不可观测状态，但其对应的极点 $(C, A)$ 具有负实部，那么与可镇定性类似 ，称系统可检测。这个性质表示可以通过配置极点使观测器稳定。（与可镇定对比）

![15](.\image\15.png)

解释：
$$
\begin{bmatrix} 
(I-A)^{n\times n} & (-B_d)^{n\times n_d}\\
(C)^{p\times n} & (C_d)^{p\times n_d}\\
\end{bmatrix}
$$
左边块矩阵 rank 为 n（因为可观），则右边 rank 等于 $n_d$。如果 $n_d$ 大于等于 p，则会导致矩阵行数 n+p 小于列数 n+$n_d$ 。此时纵使左侧块矩阵 rank 为 n，右边 rank 等于 $n_d$。也会有一行重合，导致rank < n+$n_d$ 。

对扰动 d 建模完成后，可以使用 Kalman 滤波器对增广后的状态（1.43a）进行估计，得到 $\widetilde{x}(k)$ ，$\widetilde{d}(k)$ 。

令 $\widetilde{d}_s=\widetilde{d}(k)$ 在每一时刻求解以下优化问题，就可以得到扰动影响最小的稳态：

![17](.\image\17.png)

![18](.\image\18.png)

这里增广的 $d$ 和 卡尔曼滤波器的 w 没有关系，代表未建模的干扰。



### Chapter 2

