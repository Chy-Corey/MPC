### 总结

本文提出了一种用于**跟踪受约束非线性系统** **piecewise 参考指令** 的 MPC，该控制器能够处理片断恒定设定点信号的**突然大幅变化**。

该控制器将人工参考作为额外的决策变量，并使预测轨迹与人工参考的跟踪误差以及该参考与所提供设定点之间的距离最小化。

稳定设计基于终端成本函数和终端约束区域的适当选择。实践证明，使用终端约束和不使用终端约束都能实现稳定。

假定参考值在足够长的时间内保持不变，如果是容许（admissible，可实现）的，控制器会渐近地将系统导向参考值。否则，受控系统将收敛到容许的稳定状态，使成本函数最小化。



> 该控制器将人工参考作为额外的决策变量，并使预测轨迹与人工参考的跟踪误差以及该参考与所提供设定点之间的距离最小化。

这里人工参考作为额外的决策变量的作用即为参考管理（reference governor），保证的是递归可行性。稳定性的保证还是通过终端约束和终端成本。



### 系统模型

模型：

<img src=".\img\01.png" alt="01" style="zoom:80%;" />

约束：

<img src=".\img\02.png" alt="02" style="zoom:80%;" />

稳态：

<img src=".\img\03.png" alt="03" style="zoom:80%;" />

文章为了防止约束“**激活**”（active），建立了受限（restricted）约束集：

这里的激活我理解为数值达到约束边界。

<img src=".\img\04.png" alt="04" style="zoom:80%;" />

$\varepsilon$ 是一个非常小的正数。

那么约束未激活的稳态集合可以表示为：

<img src=".\img\05.png" alt="05" style="zoom:80%;" />

那么集合 $Z_s$ 内的稳态就可以逼近约束边界但不激活约束。



**假设1：** 稳态可以由目标输出 $y_s$ 唯一决定，且连续变化：

<img src=".\img\06.png" alt="06" style="zoom:80%;" />



针对这个非线性受约束系统，要设计一个 MPC ：对于给定的参考点（设定点或输出目标）$y_t$，闭环系统是稳定的，能**满足约束条件**，并收敛（尽可能接近）到由给定设定点 $y_t$ 计算得到的平衡点。此外，即使设定点 $y_t$ 突然变为一个不同恒定值，也要**满足闭环稳定性**。



### MPC 设计

<img src=".\img\07.png" alt="07" style="zoom:80%;" />

前三项用于衡量跟踪误差，最后一项衡量参考指令的偏差。

结合约束、不变集，写出优化问题：

<img src=".\img\08.png" alt="08" style="zoom:80%;" />

稳态的对应计算公式 (9 g) 如果计算不出来，也可以直接替换为：

<img src=".\img\09.png" alt="09" style="zoom:80%;" /> 



### 不变集的计算

<img src=".\img\10.png" alt="10" style="zoom:80%;" />



#### 线性系统

根据不变集的定义：

![11](.\img\11.png)

其中 w 是状态， $W_\lambda$ 是约束。

这个集合是通过迭代的形式定义的，就可以用迭代来求解：

![12](.\img\12.png)

也可以通过 Lyapunov 函数求解不变集。

![20](.\img\20.png)

#### 非线性系统

非线性系统无法通过求解线性优化问题离线得到不变集，一般采用Lyapunov方法：

![13](.\img\13.png)

这种方法要在非线性模型中找到一个 Lyapunov 函数，比较困难；文章：

> Chen H, Allgöwer F. A quasi-infinite horizon nonlinear model predictive control scheme with guaranteed stability[J]. Automatica, 1998, 34(10): 1205-1217.

提供了一种线性化的方法，因为线性模型的 Lyapunov 方程比较好找：

![14](.\img\14.png)



### $V_O$ 的设计

文章没有提及，根据观察文中仿真的设定，$V_O$ 设置的比较大，数值上一般在 Q 矩阵的 100 倍。

![15](.\img\15.png)



### $V_f$ 设计

 文章未说明如何设计，在仿真部分，文章直接使用了线性化后的系统方程，求解Lyapunov方程得到 cost to go：

![16](.\img\16.png)

### 文章提供的解决方法

#### 终端相等约束

直接令终端状态等于稳态，这样就不需要终端代价和终端约束。这种方法会损失递归可行性。

<img src=".\img\17.png" alt="17" style="zoom:80%;" />

<img src=".\img\18.png" alt="18" style="zoom:80%;" />

#### 无终端约束设计

$V_f$ 终端代价是 Lyapunov 函数，参考上述不变集的计算，可以用 $V_f$ 来表达不变集：

![19](.\img\19.png)

$V_f$ 围绕 0 点递减，只要选择一个合适的 $\alpha$ 满足系统约束即可。

对于优化问题（9）：

<img src=".\img\21.png" alt="21" style="zoom:80%;" />

其优化目标函数为：

<img src=".\img\07.png" alt="07" style="zoom:80%;" />

现对目标函数的终端代价进行修改，修改为加权代价：$\gamma V_f(x-x_s,ys)$ 。

**进行这种修改只是为了推导出最优的无终端约束的价值函数。**

接下来定义五终端约束的优化问题：

![22](.\img\22.png)

这种修改，类似于硬约束转化为软约束，即通过增加终端代价（cost to go）的权重来达到终端约束的效果。



定义 $V_{N_c,N_p}^{\gamma, 0}(x,y_t)$ 为上面优化问题 $P_{N_c, N_p}^{\gamma}(x,y_t)$ 的最优值，定义集合：

![23](.\img\23.png)



首先要说明 cost function 表达的是跟踪误差，这个集合量化了能够较好进行跟踪的状态 x 的范围。

$N_pd$ 表示不变集中跟踪误差的上限，$\gamma \alpha$ 表示不变集中终端代价的上限。

在这个集合内部的所有状态 x，作为初始状态时，系统的稳定性都能够得到保证。



$\gamma$ 越大，集合 $\Upsilon_{N_p,\gamma}(y_t)$ 代表的稳定区域越大，文中没有证明，直观理解就是 $\gamma$ 越大，终端代价权重越大，“约束”效果越强，会让更多范围的初始状态进入不变集。



接下来就是计算参数 $\gamma$ 。

<img src=".\img\24.png" alt="24" style="zoom:80%;" />

