### Fault-tolerant reference generation for model predictive control with active diagnosis of elevator jamming faults



#### Abstract

- 研究问题

  升降舵干扰(jamming)故障情况下的纵向控制问题

- 控制策略

  使用可重构容错预测控制来解决永久和临时的执行器卡死故障

- 特点

  MPC 作为容错控制器可以帮助故障检测模块区分永久和临时的卡斯故障。

  每次检测到故障时，故障检测模块命令 MPC 执行预定义的重构序列来诊断故障的根本原因。

  一个人工参考信号，能够反映执行器工作范围，被用来指导系统泰国这个信号序列来重构。



#### 故障描述

![01-01](.\image\01-01.png)

- 卡死故障(stuck fault)：升降舵永久卡在某个位置，无法恢复（图1）。这种效果可以建模为升降舵运行上限和下限在时间 $t_f$ 处的永久变化。
- 失速载荷(stall load)：失速载荷情况对应于发生过重的空气动力，从而阻止了指令控制面偏转的实现。执行器反应的拮抗力的净和大于可用的液压功率[18]。由于沉重的空气动力阻止升降舵实现其指令控制面偏转，升降舵在动态机动过程中会暂时卡住（图 2）。在这种情况下，升降舵仍然可以在其降低的控制限值内运动。如果机动变得不那么强烈或作用在控制面上的空气动力变小，失速载荷就会结束。

考虑到它们对控制限值和干扰持续时间的不同影响，卡斯故障和失速负载需要区分，并要求在 FTC 中采用不同的重新配置策略。然而，由于干扰现象的高度相似性，很难区分这两个根本原因。因此，本文提出的集成FTC方法主动修改控制策略，以帮助FD模块区分干扰的2个根本原因，在第四节中。



这项工作的重点是干扰故障，对于这种故障，区分干扰的根本原因并非易事。虽然在某些实际情况下，失速负载限制可能会随着时间的推移而发生变化，从而给控制带来挑战，但从诊断的角度来看，在这种情况下，我们仍然可以很容易地分辨出卡死的根本原因（当检测到失速负载故障时，执行器显然不会永久卡死在给定的位置上）。因此，鉴于我们的目标是设计 FD 单元与 MPC 控制器之间的交互，以诊断干扰故障的根本原因，我们并不关注具有时变限制的失速负载情况。



#### FTC 架构

本节重点介绍 FTC 架构。在这方面，图 3 提供了 FTC 设计概览，并显示了控制系统不同组件与受控工厂之间的相互作用。尤其是，图 3 用深灰色突出显示了 (i) 工厂的主要组件（即第 2.1 节中描述的增广飞机模型、饱和约束条件和传感器延迟）和 (ii) 浅灰色的容错控制器的主要组件。本节其余部分将详细介绍这些组件。

![01-02](.\image\01-02.png)

飞行器纵向模型：

![01-03](.\image\01-03.png)

升降舵的动态模型：

![01-04](.\image\01-04.png)

其中，$x_{el}$ 的分量为升降舵的位置、速度和加速，u 是 MPC 计算的控制输入。$y_{el} ≡ u_{A/C}$（即电梯位置）。



#### 升降舵状态观测器

使用龙伯格观测器观测升降舵状态(2)，每个升降舵独立拥有一个观测器，根据系统状态方程，一共有四个升降舵。

本文对升降舵采用的实现方式是，对每部升降舵而言，与升降舵位置相关的状态对应于升降舵的输出。因此，当检测到第 i 个升降舵位置出现饱和时，其他 2 个状态（与第 i 个电梯的速度和加速度相关）将设为零，而估计的位置值将设为测得的升降舵输出。这样，就可以估算电梯状态，而不需要更高级的状态估算器来处理饱和问题。

需要注意的是，如果升降舵的模型是非线性的或取决于飞行条件，增益 L 也应相应变化。如前所述，本文采用了 重构基准模型中的电梯描述，该模型假定电梯为 LTI 系统。



#### 扰动观测器

扰动观测器用于补偿恒定测量误差，减少设备模型失配的影响，并提供有用信息帮助 FD 模块检测干扰故障。拟议的观测器主要依赖于 MPC 控制器提供的信息和设备测量结果。

观测器由两个模块组成，分别用于补偿 (i) 测量误差和 (ii) 工厂模型失配。具体而言，第一个模块对恒定干扰信号（然后由 MPC 控制器使用）进行如下估算。

首先，本文的 MPC 控制器不在预测器（优化问题）中模拟传感器和滤波器的动态，以减少决策变量的数量（从而减少计算时间）。因此，观测器监测 $e_{nz}=n_z^m-n_z^p$ ，即荷载系数的测量值与预测值之间的不匹配。

其次，观测器会监测 $e_{\delta_{ei}}=\delta_{ei}^m-\delta_{ei}^p$，即测量到的升降舵输出与预测的升降舵输出之间的不匹配，以达到检测升降舵干扰的目的。（**如果没有故障，该项会是 0 ，如果发生了饱和，由于文章已经设定饱和时测量值的设定方法，所以也是 0 ，只有在发生故障时，通过升降舵观测器得到的输出和测量的输出会有偏差**）

因此，扰动观测器的第一个模块的观测估计值：

![01-05](.\image\01-05.png)

这个估计干扰 d 会影响预测的电梯输出、飞机状态和飞机输出。因此，我们必须将该扰动视为 MPC 预测模型中的附加状态。

扰动观测器的第二个模块考虑到了设备与模型之间的不匹配，以及最终在 MPC 控制器中没有建模的设备非线性因素，因为只有线性化的设备模型才能用于建立预测。

本文将这些设备-模型不匹配的上限定义为$\varepsilon_{nl}=||\hat{x}_t-x_{t|t-1} ||_2$，其中，$\hat{x}_t$ 是飞机在 t 时间的测量状态，$x_{t|t-1}$ 是（MPC 控制器）根据 t-1 时间的测量状态值预测的 t 时间的状态值。该上限可监控设备预测行为与实际行为之间的距离，并可用于设计鲁棒的参考信号，以避免在 MPC 问题表述中出现违反约束的情况。

**remark**：(3) 中描述的策略只能用于估计可模拟为恒定值的干扰。因此，考虑到设备模型不匹配和设备的非线性因素不能被模拟为恒定干扰，本文将其影响纳入 MPC 约束条件的定义中。



#### 故障检测模块

FD 模块依靠升降舵输出预测误差 $e_{𝛿ei}$ 来计算用于检测干扰故障的残差信号。每个升降舵生成的误差通过一个滑动窗口中的平方根表示：
![01-06](.\image\01-06.png)

$N_{eval}$ 根据执行器的最慢模式进行选择。这是一种经验性选择，目的是让物理系统有足够的时间记录干扰故障。选择 $N_{eval}$ 是在降低漏检/误报风险和检测延迟之间的权衡。

FD 决策是通过比较每个残差评估值 $J_i(t)$ 和相关阈值 $J^{th}_i$，即

![01-07](.\image\01-07.png)

在确定滑动窗口的长度后，阈值 ${J_i(t)}$ 由升降舵模型 (2) 的设备模型不匹配度决定。实际上，每个阈值 $J^{th}_i$ 可以在大量无故障情况下选择 Ji(t) 的峰值。
本文通过使用动态无故障机动（即失速负载更有可能发生时）来确定阈值。阈值的选择需要在减少漏检/误报和减少检测延迟之间进行权衡。

**remark**：需要注意的是，在这项工作中，本文依赖于固定 $J^{th}_i$ 的简单 FD 逻辑来介绍本文的综合方法。尽管如此，本文提出的方法还可以通过使用更复杂的检测技术来选择阈值 $J^{th}_i$。

此外，本文还增加了一项额外的检查，以改进对单独故障的检测，可以利用冗余，即冗余控制面的存在。在无故障的条件下，每部升降舵的残差信号都足够小，并且相互接近（就幅度而言）。假设其中一个残差信号开始偏离其他信号。这种异常行为表明，与该残差信号相关的电梯可能受到了干扰。当需要处理 1 个或 2 个执行器上的孤立故障时，这种策略非常有用。例如，这种策略有助于预测卡死故障的检测，因为永久性卡死更有可能发生在单个电梯上。

**remark**：上述检测逻辑本身不足以确定干扰的根本原因，因为它只能通知控制器致动器受到干扰。在此阶段，控制器并不知道干扰是永久性的还是暂时性的。在第 4 节中，本文将公式 (5) 中的检测逻辑与不同的主动重新配置相结合，以获取更详细的故障信息。



#### 模型预测控制器

用于 MPC 的状态空间为：

![01-08](.\image\01-08.png)



本文的目标是控制飞机的纵向动态。具体来说，目标是将系统 (6) 的输出引导到所需的参考值（表示为 𝜈）上，由飞行员操纵杆指令产生。参考值在每次采样时测量，假设它在 MPC 问题表述的预测范围内是恒定的。此外，还必须考虑到作用于状态、输入和输出的约束条件。因此，与作者的其他工作相比，本文采用的是 Limón 等人23 和 Ferramosca 等人的工作中提出的 MPC 追踪公式的改进版。

![01-09](.\image\01-09.png)

![01-10](.\image\01-10.png)


约束条件 (7e) 可以防止生成的轨迹在预测范围内变得不可行（在无故障情况下，$g=g_{\theta}$）。与作者之前提出的策略相比，该策略具有以下优势：

在每个问题实例中，如果检测到执行器上存在干扰故障只需对 $𝜃_t$ 的约束条件进行简单的重新配置（即根据故障的严重程度改变 $g_𝜃$ 的定义，但不改变状态和控制指令的初始可行区域），就能为状态、输入和输出生成一个可行的参考信号，引导系统进入新的（故障后的）可行区域。这个参考信号显然是次优的（注意，我们使用了 (8) 中的 2 范数来惩罚与𝜈 的距离，这并不是精确的惩罚），但却能确保更安全地过渡到故障后控制器的可行区域。

**remark：**使用这种方法的一个问题是 MPC 控制器所控制系统的稳定性。在 Ferramosca 等人的研究中，在 MPC 问题的表述中引入了一个用于跟踪的终端集、 在 MPC 问题表述中引入了跟踪终端集，以保证稳定性。当发生干扰故障时，会影响终端集的定义，终端集会根据故障的严重程度而缩小。虽然严格的稳定性证明不在本文讨论范围之内（我们的主要重点是提供一种利用控制重构对干扰故障进行主动诊断的策略，因此在本文的其余部分，我们考虑的是不影响系统稳定性的操作），但我们提供了不同的可能策略/指南，以便在出现故障时设计鲁棒的 MPC 控制器。

1. 干扰故障可视为（可能持续存在的）扰动，其边界在基于某些启发式方法（例如，通过考虑不同的故障合）计算的给定集中。然后，基于最差故障组合计算出的用于跟踪的稳健终端集可用于 MPC 计算（从而实现基于管道的 MPC 跟踪设计）。
2. 如果在当前的设置中，我们包括一个用于跟踪的终端集，当故障发生时，MPC 问题表述中唯一的重新配置会影响用于生成人工参考信号的参数𝜃。优化器会计算出最佳的人工参考轨迹，在跟踪性能和约束满足度之间进行折中。因此，如果（根据故障的严重程度）收紧与参数𝜃 相关的约束条件，就可以直接防止违反用于跟踪的原始终端集（状态和控制指令保持不变）。
3. 另外，如果我们在当前的 MPC 公式中包含一个用于跟踪的终端集（如上一点所述），那么一种解决方案是收紧终端集，收紧量与模型中的故障和不确定性成正比。与增强型飞机模型相关的终端集还考虑了执行器的动态特性。因此，执行器边界的变化将影响动态和相关紧缩参数的选择。

需要注意的是，与 (7d) 相比，人工状态 (7e) 的约束被收紧了（E 是用于选择发生收紧的状态约束子集的矩阵），收紧量为$𝜀_{nl}$，由扰动观测器在每次采样时计算得出。这种额外的紧缩使控制器能够考虑到设备模型失调/非线性的影响，这些影响在预测模型 (7b) 中没有建模，也不能作为恒定扰动建模 (3)。因此，$(\hat{x},\hat{u})$ 的生成考虑到了设备与模型的不匹配，从而生成鲁棒的人工参考，而不是直接影响状态和控制输入的约束大小。

一般来说，MPC 控制器可在线解决优化问题 (7)，并返回最优的状态和控制输入序列，使成本 (7a) 最小化。
最佳序列定义如下：

![01-11](.\image\01-11.png)

在闭环中只执行 **u** 的第一个元素，即使用 MPC 控制器得到的控制规律为：

![01-12](.\image\01-12.png)



#### FD-MPC 设计

本节旨在描述在本文提出的集成式 FTMPC 方法中，FD 模块与 MPC 控制器（分别在第 3.3 节和第 3.4 节中描述）之间的密切互动。图 4 总结了这些相互作用。下面，将展示 MPC 控制器如何利用 FD 模块获得的故障信息，以及 MPC 控制器如何主动修改其重新配置策略，以协助 FD 模块诊断检测到的升降舵干扰的根本原因。

![01-13](.\image\01-13.png)

##### Detection

如图 4 所示，在检测阶段，FD 模块通过评估相应的残差信号 $e_{𝛿ei}$ 来持续监控每部升降舵。如果与第 i 台电梯相关的残差评估信号 Ji 在时间 $t_{fi}$ 超过预定义阈值 $J^{th}_i$ ，则 FD 模块检测到升降舵被卡住。在此阶段，干扰的根本原因仍然未知。因此，FD 模块向 MPC 控制器发送信息，启动第一次重构（即图 4 中的诊断重构）。

##### Reconfiguration for diagnosis

诊断重构的目的是帮助 FD 模块了解干扰故障的根本原因。MPC 控制器会在 $t_{fi}$ 时刻检查 $e_{𝛿ei}$ 的符号，以决定是修改 $\bar{\delta}_{ei}$ 还是修改 $\underline{𝛿}_{ei}$ ，即修改第 i 个电梯的上限值还是下限值。MPC 中的这一修改**只影响 $g_𝜃$ 的定义**（即用于生成人工参考信号的参数𝜃 的可行区域）。这种修改能够将受干扰的升降舵边界暂时设置为一个收紧值 $𝛿^f_{ei}±𝛾$，其中 $𝛿^f_{ei}$ 是升降舵在 $t_{fi}$ 时刻的测量值，𝛾 是一个正常数，应调整得足够小，以保持控制器的性能，但同时又要足够大，以允许残差信号的大小超过预定的阈值 $J^{th}_i$ 的阈值。
MPC 会在长度为 𝜏 的采样时刻中保持这个新的 𝛾 缩进边界。一方面，𝜏 必须选得足够大，以确保控制指令 u 有时间适应更新后的（就可行区域而言）参数 𝜃；另一方面，𝜏 必须选得足够小，以保持性能（尤其是在误报或故障卡住的情况下）。将 𝜏 设置为与预测范围 N 成比例是合理的。



##### diagnosis of the root cause

如果 $J_i(t_{fi} + 𝜏) < J^{th}_i$，则 FD 模块确认失速负载是干扰故障的根本原因。因为控制器显示（使用重新配置进行诊断）受干扰的电梯仍可在其缩小的范围内移动。如果 $J_i(t_{fi} + 𝜏) \geq J^{th}_i$，则 FD 模块会确认电梯卡住是干扰故障的根本原因，因为故障电梯无法达到收紧的边界。



##### reconfiguration for stuck fault

一旦 FD 模块告知干扰故障的根本原因，MPC 控制器就会执行第二次重新配置。如果诊断结果是升降舵被卡住，则 MPC 控制器将 $g_\theta$ 的定义中 $\bar{\delta}_{ei}$ 和 $\underline{\delta}_{ei}$ 都设置为 $𝛿^f_{ei}$ (测量值)，从而对被卡住的升降舵执行重新配置，如图 4 所示。 这样，人工参考生成，以考虑到第 𝜃 台升降舵永久停留在故障位置，并相应调整其余无故障电梯的参考值。第二次重新配置也是卡死升降舵的最后一次重新配置。



##### reconfiguration for stall-load start

如果诊断结果是第 i 台电梯出现失速负载，则 MPC 控制器会从失速负载的起始点进行重新配置，以检测失速负载的结束。在这种情况下，控制器会根据时间 $t_{fi}$ 时 $e_{𝛿_{ei}}$ 的符号，将之前修改的边界（$\bar{\delta}_{ei}$ 或 $\underline{\delta}_{ei}$)设置为新值 $𝛿^𝑓_{ei}±𝛼$ ，也就是说，控制器允许第 i 个升降舵拥有一个更大的边界。通过这一新的界限，我们可以检测到升降舵在失速载荷结束时是否偏离了暂时卡住的位置。

**remark：** 设置 𝛼 = 0 可能会阻止 FD 模块监测失速载荷的结束，因为升降舵无法执行超出其缩小边界的指令。由于未检测到失速载荷的结束，升降舵的减界可能会导致严重的控制性能下降。



##### detection of the end of stall load

在为失速负载启动重新配置期间，FD 模块会持续监控升降舵的测量位置 $𝛿_{ei}^m$ 与之前被卡住的位置 $𝛿^f_{ei}$ 之间的差异。如果 $|𝛿^m_{ei} - 𝛿^𝑓_{ei}| ≤ 𝛼$，则 FD 模块会告知第 i 部升降舵的失速负载仍存在，而 MPC 控制器会保持当前配置。当这一条件不满足时，FD 模块向控制器通报失速负载结束，并返回监控残差值。



##### reconfiguration for stall-load end

当失速负载结束时，MPC 必须恢复原来的饱和限制（即 $g_𝜃 = g$），这是失速负载的最后一次重新配置。

**remark：** 由于 FD 模块的解耦结构可独立监控每个升降舵，因此 MPC 重构可同时处理多个电梯故障。不过，在这项工作中，我们考虑的是对称故障，即如果左内升降舵发生干扰故障，右内升降舵也会发生同样的故障。之所以做出这样的选择，是因为非对称故障会影响飞机的横向行为，需要使用不同的（更复杂的）模型来建立 MPC 预测。

**remark：** 与作者之前的工作相比，MPC 问题表述中的所有重新配置都不影响状态和控制指令，而只影响参数 𝜃 的可行区域。这些重新配置会影响人工参考信号的生成方式，并允许从无故障区域更平滑地过渡到有故障的可行区域（通过为每个故障问题的状态和执行器生成可行的参考信号）。







### 两个观测器

升降舵的动态模型：

![01-04](.\image\01-04.png)

其中，$x_{el}$ 的分量为升降舵的位置、速度和加速，u 是 MPC 计算的控制输入。$y_{el} ≡ u_{A/C}$（即升降舵位置）。

通过状态观测器可观测升降舵的状态，并且可在 t 时刻预测 t+1 时刻的状态，就可以用预测的状态计算得到 t+1 时刻的输出（预测输出）。如果预测的输出和实际测量的输出不相等($e_{\delta_{ei}}\neq 0$)，说明存在扰动，可能有故障。（通过这种形式可以观测到mpc得到的控制输入的实际作用效果）

为什么不直接用mpc的控制输入减去 $y_{el}$ ？可能因为本文考虑了执行器的作用效率，给定的控制输入可能需要一段时间，执行器才能完成任务。

观测状态还用于 MPC 的状态方程中：

![01-08](.\image\01-08.png)

在这个状态空间方程中，如果没有 $y_{el}$ 和 $x_{el}$ ，好像也没有什么影响，可能是因为上层给定的轨迹 $v$ 包含了执行器的位置。



对于扰动观测器的第一部分：

![01-05](.\image\01-05.png)

使用积分形式建模，可以使用 kalman 滤波对 d 进行估计，从而减小测量误差的影响。

![01-14](.\image\01-14.png)

本文中的扰动 d 可以直接计算出其积分项：

![01-05](.\image\01-05.png)

直接通过积分形式得到稳定的 $\hat{d}$ 是否可行：

![01-15](.\image\01-15.png)



通过这两个观测器，能够考虑扰动和升降舵的真实位置。
