能够控制深度z，但是y轴会产生偏移：
![image-20240618152214384](C:\Users\23147\AppData\Roaming\Typora\typora-user-images\image-20240618152214384.png)

参考轨迹和权重矩阵：

```python
mpc_state_stable = np.array(
            [eta[0] + 0.05, 0.0, 15.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]) \
            .reshape(-1, 1)  # 小车末了状态 3.14 / 180 * 1

Q = ca.diag([100.0, 100.0, 100.0, 10.0, 50.0, 50.0, 0.0, 0.0, 0.0, 50.0, 50.0, 50.0])
```



可能原因：

- 模型的问题
- 直接对 y 控制不可控，可能要控制 yaw angle 。





调整权重矩阵后得到结果：

![image-20240618153558007](C:\Users\23147\AppData\Roaming\Typora\typora-user-images\image-20240618153558007.png)

参考轨迹和权重矩阵：

```python
mpc_state_stable = np.array(
            [eta[0] + 0.05, 0.0, 15.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]) \
            .reshape(-1, 1)  # 小车末了状态 3.14 / 180 * 1

Q = ca.diag([100.0, 0.0, 100.0, 10.0, 50.0, 500.0, 0.0, 0.0, 0.0, 50.0, 50.0, 50.0])
```

权重矩阵不关心 y 的偏移，而是专注于控制偏航角 yaw 为 0，结果是 y 的偏移减小。



再次调整权重：

![image-20240618154121629](C:\Users\23147\AppData\Roaming\Typora\typora-user-images\image-20240618154121629.png)

参考轨迹和权重矩阵：

```python
mpc_state_stable = np.array(
            [eta[0] + 0.05, 0.0, 15.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]) \
            .reshape(-1, 1)  # 小车末了状态 3.14 / 180 * 1

Q = ca.diag([100.0, 500.0, 100.0, 10.0, 50.0, 60.0, 0.0, 0.0, 0.0, 50.0, 50.0, 50.0])
```

权重矩阵增大了 y 的权重，偏移反而增加了。



结合以上三个权重以及仿真结果，推测是MPC 模型关于 y 的部分错了，可能是符号反了，导致一直向相反方向偏。